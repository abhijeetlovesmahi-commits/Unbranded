<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login | Imperial Portal</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    <script src="init.js"></script>
</head>
<body style="display:flex; align-items:center; justify-content:center; height:100vh; background: linear-gradient(135deg, #002366 0%, #001a4d 100%);">

    <div class="royal-card" style="width: 380px; border-top: 10px solid var(--accent);">
        <center>
            <h2 style="font-family:'Cinzel'; color:var(--primary);">IMPERIAL LOGIN</h2>
            <p style="font-size:0.8rem; color:#666;">Enter your credentials to access the treasury.</p>
        </center>
        
        <div class="form-group" style="margin-top: 25px;">
            <label>User ID / Email</label>
            <input type="email" id="email" placeholder="admin@school.com">
        </div>
        <div class="form-group" style="margin-top: 15px;">
            <label>Secret Password</label>
            <input type="password" id="pass" placeholder="••••••••">
        </div>
        
        <button class="btn-royal" style="width:100%; margin-top:25px;" onclick="handleLogin()">Unlock Access</button>
        
        <div id="loginMsg" style="margin-top:15px; text-align:center; font-size:0.8rem; color:var(--danger);"></div>
    </div>

<script>
async function handleLogin() {
    const e = document.getElementById('email').value;
    const p = document.getElementById('pass').value;
    const msg = document.getElementById('loginMsg');

    try {
        const userCredential = await auth.signInWithEmailAndPassword(e, p);
        const user = userCredential.user;
        
        // Fetch role from Firestore
        const roleDoc = await db.collection('users').doc(user.uid).get();
        if (roleDoc.exists) {
            localStorage.setItem('userRole', roleDoc.data().role);
            localStorage.setItem('userEmail', e);
            window.location.href = 'index.html';
        } else {
            msg.innerText = "Authorized role not found!";
        }
    } catch (error) {
        msg.innerText = "Invalid Credentials!";
    }
}
</script>
</body>
</html>
