<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admission | Imperial System</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    
    <script src="init.js"></script>
</head>
<body>

<div class="wrapper">
    
    <script src="menu.js"></script>

    <div class="main-content">
        <div class="royal-card">
            <h2 class="card-title"><i class="fas fa-user-plus"></i> Student Admission Registry</h2>
            
            <form id="admissionForm">
                <div style="text-align: center; margin-bottom: 30px;">
                    <input type="file" id="stPhoto" accept="image/*" onchange="previewPhoto(this)" style="display: none;">
                    <div onclick="document.getElementById('stPhoto').click()" style="cursor: pointer;">
                        <img id="imgPreview" src="https://via.placeholder.com/150x180?text=Upload+Photo" 
                             style="width: 120px; height: 150px; border: 3px solid var(--primary); border-radius: 10px; object-fit: cover;">
                    </div>
                    <p style="font-size: 0.8rem; color: #666;">Click image to upload student photo</p>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Student Full Name</label>
                        <input type="text" id="sName" placeholder="Rahul Kumar" required>
                    </div>
                    <div class="form-group">
                        <label>Admission Class</label>
                        <select id="sClass" required>
                            <option value="">-- Select --</option>
                            <option value="Nursery">Nursery</option>
                            <script>for(let i=1; i<=12; i++) document.write(`<option value="${i}">Class ${i}</option>`);</script>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Father's Name</label>
                        <input type="text" id="sFather" required>
                    </div>
                    <div class="form-group">
                        <label>Mobile Number</label>
                        <input type="tel" id="sMobile" maxlength="10" required>
                    </div>
                </div>

                <button type="submit" class="btn-royal" style="width: 100%; margin-top: 30px;">
                    <i class="fas fa-save"></i> Register Student to New Database
                </button>
            </form>
        </div>
    </div>
</div>

<script>
let photoBase64 = "";

function previewPhoto(input) {
    if (input.files && input.files[0]) {
        let reader = new FileReader();
        reader.onload = (e) => {
            photoBase64 = e.target.result;
            document.getElementById('imgPreview').src = photoBase64;
        };
        reader.readAsDataURL(input.files[0]);
    }
}

document.getElementById('admissionForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const btn = e.target.querySelector('button');
    btn.innerText = "Saving to Imperial Registry...";
    btn.disabled = true;

    const nextID = Date.now().toString().slice(-8); // Temporary Unique ID logic

    try {
        await db.collection('students').doc(nextID).set({
            uniqueID: nextID,
            name: document.getElementById('sName').value,
            class: document.getElementById('sClass').value,
            father: document.getElementById('sFather').value,
            mobile: document.getElementById('sMobile').value,
            photo: photoBase64,
            timestamp: Date.now()
        });
        alert("Success! Student ID: " + nextID);
        location.reload();
    } catch (err) {
        alert("Database Error: " + err.message);
        btn.disabled = false;
    }
});
</script>

</body>
</html>
